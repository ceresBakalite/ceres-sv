/**
 * @license
 * ceres v1.0.0
 *
 * Minified using terser v5.5.1
 * Original file: ceresbakalite/ceres-sv/repos/csvjs/ceres-sv.js
 *
 * ceresBakalite/ceres-sv is licensed under the MIT License - http://opensource.org/licenses/MIT
 *
 * Copyright (c) 2018 - 2020 Alexander Munro
*/
import{rsc}from'../prod/ceres-rsc.min.js';globalThis.ceres={},globalThis.customElements.define('ceres-sv',class extends HTMLElement{async connectedCallback(){const e={},t={};ceres.event=e=>t.instance.eventAction(e),function(){this.src=this.getAttribute('src'),e.src=rsc.ignore(this.src)?null:this.src.trim(),e.css=this.getAttribute('css')||rsc.defaultCSS,e.srcRoot=!rsc.ignore(e.src),e.shadowStyle='',e.node={},e.slide=1,e.cssRoot=rsc.removeDuplcates(e.css.trim().replace(/,/gi,';').replace(/;+$/g,'').replace(/[^\x00-\xFF]| /g,'').split(';')),function(){const o=rsc.elementName(this),n=new Map,a={markup:'Media list markup',element:'The element attributes',nodeSearch:'The '+o+' src attribute url is unavailable and there is no node name. Looking for the first occurance of a <template> or <noscript> tagname',properties:'Error: Unable to find the '+o+' document element',list:'Error: Unable to find either the '+o+' document element nor the fallback local template elements',template:'Error: Unable to find the local fallback template element when searching the document body',cache:'Warning: cache response status'};Object.freeze(a),this.instance={hasContent:()=>this.content.properties()?this.content.textList()?this.content.textArray():rsc.inspect({type:rsc.error,notification:a.list}):rsc.inspect({type:rsc.error,notification:a.properties}),showContent:()=>{this.get.shadow(),this.get.slide({shadow:e.shadow}),this.get.view()},eventAction:e=>{'img'===rsc.elementName(e)?rsc.srcOpen({element:e,type:'image'}):t.get.slide({node:e})}},this.content={properties:()=>{const t=['color','font','padding','top','bottom'],n=['sub','sur'];return(()=>{if(rsc.ignore(this))return!1;this.id=rsc.getUniqueId({name:o,range:1e3});const s=o=>{const a=this.getAttribute(o),s='cache'==o||'zoom'==o,i={track:!rsc.getBoolean(a),fade:!rsc.getBoolean(a),trace:rsc.getBoolean(a),loading:a||'auto',name:a||this.id,delay:Number.isInteger(parseInt(a,10))?parseInt(a,10):250};if(i.hasOwnProperty(o))return i[o];if(!a)return!!s;const r='sur'==o?/.surtitle[^&]*?}/i:/.subtitle[^&]*?}/i,l=/(\s+)?:(\s+)?/g,c=a.replace(l,':').split(',').map((e=>e.trim())),d=c[0];if(s)return(()=>{if('cache'==o){const t=c.length>1?c[1].includes('media'):d.includes('media')||null,o=d.includes('media')||rsc.getBoolean(d);return o&&!rsc.ignore(t)&&(e.node.cachemedia=t),o}if('zoom'==o)return!/^false$/i.test(d)&&(e.node.clickevent=c.length>1?c[1]:/^true$/i.test(d)?null:d,!rsc.ignore(e.node.clickevent)||rsc.getBoolean(d))})();if(!Number.isInteger(parseInt(d))){if(!rsc.getBoolean(d))return!1;c.length>1&&c.shift()}return'auto'==o?(e.node.autocycle=Number.isInteger(parseInt(c[0]))?parseInt(c[0]):10,e.node.autopause=Number.isInteger(parseInt(c[1]))?parseInt(c[1]):3e3,e.node.autocancel=e.node.autocycle>-1,e.node.fade=e.node.autopause>400,e.node.track='false',!0):(n.includes(o)&&(0!=c.length&&c.forEach((o=>{t.includes(o.split(':')[0])&&(t=>{const o=Boolean(t.match(/color:/i))?/color[^&]*?;/i:Boolean(t.match(/font:/i))?/font[^&]*?;/i:Boolean(t.match(/padding:/i))?/padding[^&]*?;/i:Boolean(t.match(/top:/i))?/top[^&]*?;/i:Boolean(t.match(/bottom:/i))?/bottom[^&]*?;/i:null;if(!rsc.ignore(o)){const n=String(e.shadowStyle.match(r));if(n){const a=n.replace(o,t.replace(l,':')+';');a&&(e.shadowStyle=e.shadowStyle.replace(n,a))}}})(o)}))),!0)};return e.node.track=s('track'),e.node.fade=s('fade'),e.node.cache=s('cache'),e.node.trace=s('trace'),e.node.loading=s('loading'),e.node.name=s('name'),e.node.zoom=s('zoom'),e.node.delay=s('delay'),e.node.sur=s('sur'),e.node.sub=s('sub'),e.node.auto=s('auto'),Object.freeze(e.node),e.template=(()=>{if(e.srcRoot)return'undefined';let t=document.getElementById(e.node.name)||null;return rsc.ignore(t)&&(rsc.inspect({type:rsc.notify,notification:a.nodeSearch,logtrace:e.node.trace}),t=document.getElementsByTagName('template')[0]||document.getElementsByTagName('noscript')[0]),t||'undefined'})(),!0})()},textList:()=>e.srcRoot||e.template,textArray:()=>{e.mediaArray=null,rsc.inspect({type:rsc.notify,notification:a.element+' ['+rsc.getProperties(e.node)+']',logtrace:e.node.trace});const t=/\s*\n\s*/g,o=()=>e.srcRoot?(()=>this.textContent.replace(t,'\n')||null)():(()=>{const o='template'!=rsc.elementName(e.template)?e.template.textContent:e.template.content.textContent;return rsc.ignore(o)?rsc.inspect({type:rsc.error,notification:a.template+' ['+e.node.name+']'}):this.parseText(o).replace(t,'\n')})();return(()=>{const t=o();return!rsc.ignore(t)&&(rsc.inspect({type:rsc.notify,notification:(()=>a.markup+' ['+this.id+(e.srcRoot?' - file name: '+rsc.fileName(e.src):' - node name: '+e.node.name)+']'+rsc.newline+t.replaceAll(rsc.commaSymbol,'&comma;').replace(/&lt;/g,'<').replace(/&gt;/g,'>'))(),logtrace:e.node.trace}),e.mediaArray=t?t.trim().split('\n'):null,!rsc.ignore(e.mediaArray))})()}},this.get={shadow:()=>{const t=document.querySelector('#'+this.id);rsc.clearElement(t),t.attachShadow({mode:'open'}),e.shadow=t.shadowRoot,this.compose.style(),this.compose.body(),e.node.auto||rsc.setSwipe({node:e.shadow.querySelector('div.slideview-body > div.slideview-media')},(t=>{const o=t.action?t.right:t.left;e.slide=e.slide+=o,this.get.slide({shadow:e.shadow})}),{left:-1,right:1})},slide:t=>{rsc.ignore(t.shadow)&&(t.shadow=rsc.ignore(t.node)?e.shadow:(t=>{const o=t.getRootNode().host,a=document.querySelector('#'+o.id).shadowRoot,s=a.querySelector('div.slideview-media > div.active');return e.slide=Number.parseInt(s.id.replace('svm',''),10),n.set('left',e.slide-1),n.set('right',e.slide+1),n.set('stud',Number.parseInt(t.id.replace('svt',''),10)),e.slide=n.get(t.className),a})(t.node));const o=t.shadow.querySelectorAll('div.slideview-media > div.slide'),a=t.shadow.querySelectorAll('div.slideview-track > span.stud'),s=t.shadow.querySelector('div.slideview-media > div.active'),i=t.shadow.querySelector('div.slideview-track > span.enabled');e.slide=rsc.ignore(t.autoslide)?e.slide<1?o.length:e.slide>o.length?1:e.slide:t.autoslide;const r=e.slide-1;rsc.ignore(o[r])||(s&&s.classList.replace('active','none'),i&&(i.className='stud'),o[r].classList.replace('none','active'),a[r].className='stud enabled')},view:()=>{const n=()=>{const o=e.shadow.querySelectorAll('div.slideview-media > div.slide'),n=e.node.autocancel&&e.node.autocycle>-1?e.mediaArray.length*e.node.autocycle:0;let a=0,s=1;const i=setInterval((()=>{s=s<1?o.length:s>o.length?1:s,(e.node.autocancel?a===n||(s++,a++,0):(s++,0))&&clearInterval(i),t.get.slide({autoslide:s-1})}),e.node.autopause)};setTimeout((()=>{e.node.auto&&setTimeout((()=>{n()}),e.node.delay),t.setDisplay.show()}),e.node.delay),e.node.cache&&(()=>{if(!globalThis.hasOwnProperty('caches'))return;const t=e.srcRoot?e.src.split():Array.from(''),n=o+'-cache',s=[];e.node.cachemedia&&e.mediaArray.forEach((e=>{let t=e.split(',');rsc.ignore(t[0])||s.push(t[0].trim())})),rsc.removeDuplcates(s.concat(t.concat(e.cssRoot.concat([import.meta.url])))).forEach((t=>{fetch(t).then((o=>(o.ok||rsc.inspect({type:rsc.warn,notification:a.cache+' ['+o.status+'] - '+t,logtrace:e.node.trace}),caches.open(n).then((e=>e.put(t,o))))))}))})(),rsc.inspect({type:rsc.notify,notification:e.shadow,logtrace:e.node.trace})}},this.compose={style:()=>{const t=document.createElement('style');t.className='slideview-style',t.insertAdjacentHTML('beforeend',e.shadowStyle),e.shadow.appendChild(t)},body:()=>{const t=()=>rsc.ignore(d.ar[0])?null:d.ar[0].trim(),o=()=>rsc.ignore(d.ar[1])?null:d.ar[1].trim().replaceAll(rsc.commaSymbol,','),n=()=>e.node.sur?rsc.ignore(d.ar[2])?d.index+' / '+e.mediaArray.length:d.ar[2].trim().replaceAll(rsc.commaSymbol,','):null,a='ceres.event(this)',s=e.node.zoom?rsc.ignore(e.node.clickevent)?a:e.node.clickevent:null,i=this.getClass('slide'),r=document.createElement('div');r.className='slideview-body';const l=document.createElement('div');l.className='slideview-media',r.appendChild(l);const c=document.createElement('div');c.className=this.getClass('slideview-track'),r.appendChild(c);const d={index:0,ar:[]};e.mediaArray.forEach((a=>{d.ar=a.split(',');const r=document.createElement('div');r.className=i,r.id='svm'+ ++d.index,l.appendChild(r),e.node.sur&&rsc.composeElement({nodeType:'div',parent:r,markup:n()},{class:'surtitle fade'}),!rsc.ignore(d.ar[0])&&rsc.isVideo(d.ar[0])?(r.classList.remove('zoom'),rsc.composeElement({nodeType:'video',parent:r,src:t(),type:rsc.mediaType(d.ar[0])},{width:'100%',autoplay:!0})):rsc.composeElement({nodeType:'img',parent:r},{class:'slide',onclick:s,src:t(),alt:o(),loading:Boolean(e.node.loading.match(/lazy|eager|auto/i))?e.node.loading:'auto'}),e.node.sub&&rsc.composeElement({nodeType:'div',parent:r,markup:e.node.sub?o():null},{class:'subtitle fade'})})),e.mediaArray.length>1&&(rsc.composeElement({nodeType:'a',parent:l},{class:this.getClass('left'),onclick:a}),rsc.composeElement({nodeType:'a',parent:l},{class:this.getClass('right'),onclick:a})),e.mediaArray.forEach(((e,t)=>{rsc.composeElement({nodeType:'span',parent:c},{class:'stud',id:'svt'+ ++t,onclick:a})})),e.shadow.appendChild(r)}},this.setDisplay={hide:()=>{this.style.visibility='hidden',this.style.display='none'},show:()=>{this.style.removeProperty('display'),this.style.removeProperty('visibility'),0===this.style.length&&this.removeAttribute('style')}},this.getClass=t=>'slide'!=t?e.node.track&&(e.node.auto||e.mediaArray.length<2)?t+=' none':t:(e.node.zoom&&(t+=' zoom'),e.node.fade&&(t+=' fade'),t+' none'),this.parseFile=t=>{const o=rsc.fileType(e.src,'json')?this.parseJSON(t):rsc.fileType(e.src,'csv')?this.parseJSON(rsc.parseCSV(t,{json:!0,nodes:['url','sub','sur'],commaCodes:rsc.commaCodes,commaSymbol:rsc.commaSymbol})):t;return this.parseText(o)},this.parseText=e=>rsc.softSanitize(e.replace(/\\,|&comma;|&#x2c;|&#44;|U+0002C/g,rsc.commaSymbol).replace(/^\s*?<template(.*?)>|<\/template>\s*?$/,'')).trim(),this.parseJSON=e=>{const t=JSON.parse(e);let o='';return t.forEach((e=>{o+=e.url+(e.sub?', '+e.sub.replace(rsc.commaCodes,rsc.commaSymbol):'')+(e.sur?', '+e.sur.replace(rsc.commaCodes,rsc.commaSymbol):'')+'\n'})),o},Object.seal(t)}.call(t)}(),t.setDisplay.hide(),e.srcRoot&&this.insertAdjacentHTML('afterbegin',t.parseFile(await(await fetch(e.src)).text()));for(let t of e.cssRoot)e.shadowStyle+=rsc.softSanitize(await(await fetch(t)).text());t.instance.hasContent()&&t.instance.showContent()}});