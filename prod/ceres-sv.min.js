/**
 * @license
 * ceres v1.0.0
 *
 * Minified using terser v5.5.1
 * Original file: ceresbakalite/ceres-sv/repos/csvjs/ceres-sv.js
 *
 * ceresBakalite/ceres-sv is licensed under the MIT License - http://opensource.org/licenses/MIT
 *
 * Copyright (c) 2018 - 2020 Alexander Munro
*/
import{rsc}from'../prod/ceres-rsc.min.js';globalThis.ceres={},globalThis.customElements.define('ceres-sv',class extends HTMLElement{async connectedCallback(){const e=this,t={},o={};ceres.event=e=>o.instance.eventAction(e),e.src=e.getAttribute('src'),t.src=rsc.ignore(e.src)?null:e.src.trim(),t.css=e.getAttribute('css')||rsc.defaultCSS,t.srcRoot=!rsc.ignore(t.src),t.shadowStyle='',t.node={},t.slide=1,t.cssRoot=rsc.removeDuplcates(t.css.trim().replace(/,/gi,';').replace(/;+$/g,'').replace(/[^\x00-\xFF]| /g,'').split(';')),function(){const n=rsc.elementName(e),a=new Map,s={markup:'Media list markup',element:'The element attributes',nodeSearch:'The '+n+' src attribute url is unavailable and there is no node name. Looking for the first occurance of a <template> or <noscript> tagname',properties:'Error: Unable to find the '+n+' document element',list:'Error: Unable to find either the '+n+' document element nor the fallback local template elements',template:'Error: Unable to find the local fallback template element when searching the document body',cache:'Warning: cache response status'};Object.freeze(s),this.instance={hasContent:()=>this.content.properties()?this.content.textList()?this.content.textArray():rsc.inspect({type:rsc.error,notification:s.list}):rsc.inspect({type:rsc.error,notification:s.properties}),showContent:()=>{this.get.shadow(),this.get.slide({shadow:t.shadow}),this.get.view()},eventAction:e=>{'img'===rsc.elementName(e)?rsc.srcOpen({element:e,type:'image'}):o.get.slide({node:e})}},this.content={properties:()=>{const o=['color','font','padding','top','bottom'],a=['sub','sur'];return(()=>{if(rsc.ignore(e))return!1;e.id=rsc.getUniqueId({name:n,range:1e3});const i=n=>{const s=e.getAttribute(n),i='cache'==n||'zoom'==n,r={track:!rsc.getBoolean(s),fade:!rsc.getBoolean(s),trace:rsc.getBoolean(s),loading:s||'auto',name:s||e.id,delay:Number.isInteger(parseInt(s,10))?parseInt(s,10):250};if(r.hasOwnProperty(n))return r[n];if(!s)return!!i;const l='sur'==n?/.surtitle[^&]*?}/i:/.subtitle[^&]*?}/i,c=/(\s+)?:(\s+)?/g,d=s.replace(c,':').split(',').map((e=>e.trim())),m=d[0];if(i)return(()=>{if('cache'==n){const e=d.length>1?d[1].includes('media'):m.includes('media')||null,o=m.includes('media')||rsc.getBoolean(m);return o&&!rsc.ignore(e)&&(t.node.cachemedia=e),o}if('zoom'==n)return!/^false$/i.test(m)&&(t.node.clickevent=d.length>1?d[1]:/^true$/i.test(m)?null:m,!rsc.ignore(t.node.clickevent)||rsc.getBoolean(m))})();if(!Number.isInteger(parseInt(m))){if(!rsc.getBoolean(m))return!1;d.length>1&&d.shift()}return'auto'==n?(t.node.autocycle=Number.isInteger(parseInt(d[0]))?parseInt(d[0]):10,t.node.autopause=Number.isInteger(parseInt(d[1]))?parseInt(d[1]):3e3,t.node.autocancel=t.node.autocycle>-1,t.node.fade=t.node.autopause>400,t.node.track='false',!0):(a.includes(n)&&0!=d.length&&d.forEach((e=>{o.includes(e.split(':')[0])&&(e=>{const o=Boolean(e.match(/color:/i))?/color[^&]*?;/i:Boolean(e.match(/font:/i))?/font[^&]*?;/i:Boolean(e.match(/padding:/i))?/padding[^&]*?;/i:Boolean(e.match(/top:/i))?/top[^&]*?;/i:Boolean(e.match(/bottom:/i))?/bottom[^&]*?;/i:null;if(!rsc.ignore(o)){const n=String(t.shadowStyle.match(l));if(n){const a=n.replace(o,e.replace(c,':')+';');a&&(t.shadowStyle=t.shadowStyle.replace(n,a))}}})(e)})),!0)};return t.node.track=i('track'),t.node.fade=i('fade'),t.node.cache=i('cache'),t.node.trace=i('trace'),t.node.loading=i('loading'),t.node.name=i('name'),t.node.zoom=i('zoom'),t.node.delay=i('delay'),t.node.sur=i('sur'),t.node.sub=i('sub'),t.node.auto=i('auto'),Object.freeze(t.node),t.template=(()=>{if(t.srcRoot)return'undefined';let e=document.getElementById(t.node.name)||null;return rsc.ignore(e)&&(rsc.inspect({type:rsc.notify,notification:s.nodeSearch,logtrace:t.node.trace}),e=document.getElementsByTagName('template')[0]||document.getElementsByTagName('noscript')[0]),e||'undefined'})(),!0})()},textList:()=>t.srcRoot||t.template,textArray:()=>{t.mediaArray=null,rsc.inspect({type:rsc.notify,notification:s.element+' ['+rsc.getProperties(t.node)+']',logtrace:t.node.trace});const o=/\s*\n\s*/g,n=()=>t.srcRoot?e.textContent.replace(o,'\n')||null:(()=>{const e='template'!=rsc.elementName(t.template)?t.template.textContent:t.template.content.textContent;return rsc.ignore(e)?rsc.inspect({type:rsc.error,notification:s.template+' ['+t.node.name+']'}):this.parseText(e).replace(o,'\n')})();return(()=>{const o=n();return!rsc.ignore(o)&&(rsc.inspect({type:rsc.notify,notification:s.markup+' ['+e.id+(t.srcRoot?' - file name: '+rsc.fileName(t.src):' - node name: '+t.node.name)+']'+rsc.newline+o.replaceAll(rsc.commaSymbol,'&comma;').replace(/&lt;/g,'<').replace(/&gt;/g,'>'),logtrace:t.node.trace}),t.mediaArray=o?o.trim().split('\n'):null,!rsc.ignore(t.mediaArray))})()}},this.get={shadow:()=>{const o=document.querySelector('#'+e.id);rsc.clearElement(o),o.attachShadow({mode:'open'}),t.shadow=o.shadowRoot,this.compose.style(),this.compose.body(),t.node.auto||rsc.setSwipe({node:t.shadow.querySelector('div.slideview-body > div.slideview-media')},(e=>{const o=e.action?e.right:e.left;t.slide=t.slide+=o,this.get.slide({shadow:t.shadow})}),{left:-1,right:1})},slide:e=>{rsc.ignore(e.shadow)&&(e.shadow=rsc.ignore(e.node)?t.shadow:(e=>{const o=e.getRootNode().host,n=document.querySelector('#'+o.id).shadowRoot,s=n.querySelector('div.slideview-media > div.active');return t.slide=Number.parseInt(s.id.replace('svm',''),10),a.set('left',t.slide-1),a.set('right',t.slide+1),a.set('stud',Number.parseInt(e.id.replace('svt',''),10)),t.slide=a.get(e.className),n})(e.node));const o=e.shadow.querySelectorAll('div.slideview-media > div.slide'),n=e.shadow.querySelectorAll('div.slideview-track > span.stud'),s=e.shadow.querySelector('div.slideview-media > div.active'),i=e.shadow.querySelector('div.slideview-track > span.enabled');t.slide=rsc.ignore(e.autoslide)?t.slide<1?o.length:t.slide>o.length?1:t.slide:e.autoslide;const r=t.slide-1;rsc.ignore(o[r])||(s&&s.classList.replace('active','none'),i&&(i.className='stud'),o[r].classList.replace('none','active'),n[r].className='stud enabled')},view:()=>{const e=()=>{const e=t.shadow.querySelectorAll('div.slideview-media > div.slide'),n=t.node.autocancel&&t.node.autocycle>-1?t.mediaArray.length*t.node.autocycle:0;let a=0,s=1;const i=setInterval((()=>{s=s<1?e.length:s>e.length?1:s,(t.node.autocancel?a===n||(s++,a++,0):(s++,0))&&clearInterval(i),o.get.slide({autoslide:s-1})}),t.node.autopause)};setTimeout((()=>{t.node.auto&&setTimeout((()=>{e()}),t.node.delay),o.setDisplay.show()}),t.node.delay),t.node.cache&&(()=>{if(!globalThis.hasOwnProperty('caches'))return;const e=t.srcRoot?t.src.split():Array.from(''),o=n+'-cache',a=[];t.node.cachemedia&&t.mediaArray.forEach((e=>{let t=e.split(',');rsc.ignore(t[0])||a.push(t[0].trim())})),rsc.removeDuplcates(a.concat(e.concat(t.cssRoot.concat([import.meta.url])))).forEach((e=>{fetch(e).then((n=>(n.ok||rsc.inspect({type:rsc.warn,notification:s.cache+' ['+n.status+'] - '+e,logtrace:t.node.trace}),caches.open(o).then((t=>t.put(e,n))))))}))})(),rsc.inspect({type:rsc.notify,notification:t.shadow,logtrace:t.node.trace})}},this.compose={style:()=>{const e=document.createElement('style');e.className='slideview-style',e.insertAdjacentHTML('beforeend',t.shadowStyle),t.shadow.appendChild(e)},body:()=>{const e=()=>rsc.ignore(d.ar[0])?null:d.ar[0].trim(),o=()=>rsc.ignore(d.ar[1])?null:d.ar[1].trim().replaceAll(rsc.commaSymbol,','),n=()=>t.node.sur?rsc.ignore(d.ar[2])?d.index+' / '+t.mediaArray.length:d.ar[2].trim().replaceAll(rsc.commaSymbol,','):null,a='ceres.event(this)',s=t.node.zoom?rsc.ignore(t.node.clickevent)?a:t.node.clickevent:null,i=this.getClass('slide'),r=document.createElement('div');r.className='slideview-body';const l=document.createElement('div');l.className='slideview-media',r.appendChild(l);const c=document.createElement('div');c.className=this.getClass('slideview-track'),r.appendChild(c);const d={index:0,ar:[]};t.mediaArray.forEach((a=>{d.ar=a.split(',');const r=document.createElement('div');r.className=i,r.id='svm'+ ++d.index,l.appendChild(r),t.node.sur&&rsc.composeElement({nodeType:'div',parent:r,markup:n()},{class:'surtitle fade'}),!rsc.ignore(d.ar[0])&&rsc.isVideo(d.ar[0])?(r.classList.remove('zoom'),rsc.composeElement({nodeType:'video',parent:r,src:e(),type:rsc.mediaType(d.ar[0])},{width:'100%',autoplay:!0})):rsc.composeElement({nodeType:'img',parent:r},{class:'slide',onclick:s,src:e(),alt:o(),loading:Boolean(t.node.loading.match(/lazy|eager|auto/i))?t.node.loading:'auto'}),t.node.sub&&rsc.composeElement({nodeType:'div',parent:r,markup:t.node.sub?o():null},{class:'subtitle fade'})})),t.mediaArray.length>1&&(rsc.composeElement({nodeType:'a',parent:l},{class:this.getClass('left'),onclick:a}),rsc.composeElement({nodeType:'a',parent:l},{class:this.getClass('right'),onclick:a})),t.mediaArray.forEach(((e,t)=>{rsc.composeElement({nodeType:'span',parent:c},{class:'stud',id:'svt'+ ++t,onclick:a})})),t.shadow.appendChild(r)}},this.setDisplay={hide:()=>{e.style.visibility='hidden',e.style.display='none'},show:()=>{e.style.removeProperty('display'),e.style.removeProperty('visibility'),0===e.style.length&&e.removeAttribute('style')}},this.getClass=e=>'slide'!=e?t.node.track&&(t.node.auto||t.mediaArray.length<2)?e+=' none':e:(t.node.zoom&&(e+=' zoom'),t.node.fade&&(e+=' fade'),e+' none'),this.parseFile=e=>{const o=rsc.fileType(t.src,'json')?this.parseJSON(e):rsc.fileType(t.src,'csv')?this.parseJSON(rsc.parseCSV(e,{json:!0,nodes:['url','sub','sur'],commaCodes:rsc.commaCodes,commaSymbol:rsc.commaSymbol})):e;return this.parseText(o)},this.parseText=e=>rsc.softSanitize(e.replace(/\\,|&comma;|&#x2c;|&#44;|U+0002C/g,rsc.commaSymbol).replace(/^\s*?<template(.*?)>|<\/template>\s*?$/,'')).trim(),this.parseJSON=e=>{const t=JSON.parse(e);let o='';return t.forEach((e=>{o+=e.url+(e.sub?', '+e.sub.replace(rsc.commaCodes,rsc.commaSymbol):'')+(e.sur?', '+e.sur.replace(rsc.commaCodes,rsc.commaSymbol):'')+'\n'})),o},Object.seal(o)}.call(o),o.setDisplay.hide(),t.srcRoot&&this.insertAdjacentHTML('afterbegin',o.parseFile(await(await fetch(t.src)).text()));for(let e of t.cssRoot)t.shadowStyle+=rsc.softSanitize(await(await fetch(e)).text());o.instance.hasContent()&&o.instance.showContent()}});